# Apache DocumentRoot = /var/www/html/chatdemo (repo root)
# Routes all requests into build/: static files from build/, SPA routes -> build/index.html

<IfModule mod_rewrite.c>
  RewriteEngine On
  RewriteBase /

  # Serve real files and directories from build/
  RewriteCond %{DOCUMENT_ROOT}/build%{REQUEST_URI} -f [OR]
  RewriteCond %{DOCUMENT_ROOT}/build%{REQUEST_URI} -d
  RewriteRule ^(.*)$ build/$1 [L]

  # SPA fallback: all other requests -> build/index.html (React Router)
  # Only run once per request (env var prevents redirect loop on internal re-submit)
  RewriteCond %{ENV:REDIRECT_SPA} !^1$
  RewriteRule ^ build/index.html [L,E=SPA:1]
</IfModule>

# Optional: force HTTPS (uncomment if you want to redirect 80 -> 443)
# <IfModule mod_rewrite.c>
#   RewriteCond %{HTTPS} off
#   RewriteRule ^ https://%{HTTP_HOST}%{REQUEST_URI} [L,R=301]
# </IfModule>
